C51 COMPILER V8.02   IIC                                                                   12/17/2013 20:24:56 PAGE 1   


C51 COMPILER V8.02, COMPILATION OF MODULE IIC
OBJECT MODULE PLACED IN iic.OBJ
COMPILER INVOKED BY: G:\Keil\C51\BIN\C51.EXE iic.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /********************************************************************************************
   2                                    
   3                                                            惠特自动化
   4                                             http://heltec.taobao.com/
   5          
   6          **********************************************************************************************/
   7          #include "reg52.h"
   8          #define high 1
   9          #define low 0 
  10          /*************Pin Define***************/
  11          sbit RES=P1^1;
  12          sbit DC=P1^0;
  13          sbit SCL=P1^3;
  14          sbit SDA=P1^2;
  15          /****************************************************/
  16          void Initial_LY096BG30();
  17          void Delay_50ms(unsigned int Del_50ms);
  18          void Delay_1ms(unsigned int Del_1ms);
  19          void fill_picture(unsigned char fill_Data);
  20          void Picture_1();
  21          void IIC_Start();
  22          void IIC_Stop();
  23          void Write_IIC_Command(unsigned char IIC_Command);
  24          void Write_IIC_Data(unsigned char IIC_Data);
  25          void Write_IIC_Byte(unsigned char IIC_Byte);
  26          /***********************Initial code*********************/
  27          void Initial_LY096BG30()
  28          {
  29   1              Write_IIC_Command(0xAE);   //display off
  30   1              Write_IIC_Command(0x20);        //Set Memory Addressing Mode    
  31   1              Write_IIC_Command(0x10);        //00,Horizontal Addressing Mode;01,Vertical Addressing Mode;10,Page Addressing M
             -ode (RESET);11,Invalid
  32   1              Write_IIC_Command(0xb0);        //Set Page Start Address for Page Addressing Mode,0-7
  33   1              Write_IIC_Command(0xc8);        //Set COM Output Scan Direction
  34   1              Write_IIC_Command(0x00);//---set low column address
  35   1              Write_IIC_Command(0x10);//---set high column address
  36   1              Write_IIC_Command(0x40);//--set start line address
  37   1              Write_IIC_Command(0x81);//--set contrast control register
  38   1              Write_IIC_Command(0x7f);
  39   1              Write_IIC_Command(0xa1);//--set segment re-map 0 to 127
  40   1              Write_IIC_Command(0xa6);//--set normal display
  41   1              Write_IIC_Command(0xa8);//--set multiplex ratio(1 to 64)
  42   1              Write_IIC_Command(0x3F);//
  43   1              Write_IIC_Command(0xa4);//0xa4,Output follows RAM content;0xa5,Output ignores RAM content
  44   1              Write_IIC_Command(0xd3);//-set display offset
  45   1              Write_IIC_Command(0x00);//-not offset
  46   1              Write_IIC_Command(0xd5);//--set display clock divide ratio/oscillator frequency
  47   1              Write_IIC_Command(0xf0);//--set divide ratio
  48   1              Write_IIC_Command(0xd9);//--set pre-charge period
  49   1              Write_IIC_Command(0x22); //
  50   1              Write_IIC_Command(0xda);//--set com pins hardware configuration
  51   1              Write_IIC_Command(0x12);
  52   1              Write_IIC_Command(0xdb);//--set vcomh
  53   1              Write_IIC_Command(0x20);//0x20,0.77xVcc
  54   1              Write_IIC_Command(0x8d);//--set DC-DC enable
C51 COMPILER V8.02   IIC                                                                   12/17/2013 20:24:56 PAGE 2   

  55   1              Write_IIC_Command(0x14);//
  56   1              Write_IIC_Command(0xaf);//--turn on oled panel 
  57   1      }
  58          /***********************Picture Code**************************/
  59          unsigned char code show1[]=
  60          {
  61                  0x00,0x03,0x05,0x09,0x11,0xFF,0x11,0x89,0x05,0xC3,0x00,0xE0,0x00,0xF0,0x00,0xF8,
  62                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x44,0x28,0xFF,0x11,0xAA,0x44,0x00,0x00,0x00,
  63                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  64                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  65                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  66                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x83,0x01,0x38,0x44,0x82,0x92,
  67                  0x92,0x74,0x01,0x83,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x44,0xFF,0x01,0x7D,
  68                  0x7D,0x7D,0x01,0x7D,0x7D,0x7D,0x7D,0x01,0x7D,0x7D,0x7D,0x7D,0x7D,0x01,0xFF,0x00,
  69                  0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  70                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x00,
  71                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  72                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  73                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  74                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,
  75                  0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,
  76                  0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,
  77                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  78                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0x3F,0x03,0x03,
  79                  0xF3,0x13,0x11,0x11,0x11,0x11,0x11,0x11,0x01,0xF1,0x11,0x61,0x81,0x01,0x01,0x01,
  80                  0x81,0x61,0x11,0xF1,0x01,0x01,0x01,0x01,0x41,0x41,0xF1,0x01,0x01,0x01,0x01,0x01,
  81                  0xC1,0x21,0x11,0x11,0x11,0x11,0x21,0xC1,0x01,0x01,0x01,0x01,0x41,0x41,0xF1,0x01,
  82                  0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x11,0x11,0x11,0x11,0x11,0xD3,0x33,
  83                  0x03,0x03,0x3F,0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  84                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  85                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  86                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xE0,0x00,0x00,
  87                  0x7F,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x7F,0x00,0x00,0x01,0x06,0x18,0x06,
  88                  0x01,0x00,0x00,0x7F,0x00,0x00,0x00,0x00,0x40,0x40,0x7F,0x40,0x40,0x00,0x00,0x00,
  89                  0x1F,0x20,0x40,0x40,0x40,0x40,0x20,0x1F,0x00,0x00,0x00,0x00,0x40,0x40,0x7F,0x40,
  90                  0x40,0x00,0x00,0x00,0x00,0x60,0x00,0x00,0x00,0x00,0x40,0x30,0x0C,0x03,0x00,0x00,
  91                  0x00,0x00,0xE0,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  92                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  93                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  94                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x07,0x06,0x06,
  95                  0x06,0x06,0x04,0x04,0x04,0x84,0x44,0x44,0x44,0x84,0x04,0x04,0x84,0x44,0x44,0x44,
  96                  0x84,0x04,0x04,0x04,0x84,0xC4,0x04,0x04,0x04,0x04,0x84,0x44,0x44,0x44,0x84,0x04,
  97                  0x04,0x04,0x04,0x04,0x84,0x44,0x44,0x44,0x84,0x04,0x04,0x04,0x04,0x04,0x84,0x44,
  98                  0x44,0x44,0x84,0x04,0x04,0x84,0x44,0x44,0x44,0x84,0x04,0x04,0x04,0x04,0x06,0x06,
  99                  0x06,0x06,0x07,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 100                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 101                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 102                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 103                  0x00,0x00,0x00,0x00,0x00,0x10,0x18,0x14,0x12,0x11,0x00,0x00,0x0F,0x10,0x10,0x10,
 104                  0x0F,0x00,0x00,0x00,0x10,0x1F,0x10,0x00,0x00,0x00,0x08,0x10,0x12,0x12,0x0D,0x00,
 105                  0x00,0x18,0x00,0x00,0x0D,0x12,0x12,0x12,0x0D,0x00,0x00,0x18,0x00,0x00,0x10,0x18,
 106                  0x14,0x12,0x11,0x00,0x00,0x10,0x18,0x14,0x12,0x11,0x00,0x00,0x00,0x00,0x00,0x00,
 107                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 108                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 109                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 110                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 111                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 112                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,
 113                  0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 114                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 115                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 116                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
C51 COMPILER V8.02   IIC                                                                   12/17/2013 20:24:56 PAGE 3   

 117                  0x00,0x7F,0x03,0x0C,0x30,0x0C,0x03,0x7F,0x00,0x00,0x38,0x54,0x54,0x58,0x00,0x00,
 118                  0x7C,0x04,0x04,0x78,0x00,0x00,0x3C,0x40,0x40,0x7C,0x00,0x00,0x00,0x00,0x00,0x00,
 119                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 120                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xAA,0xAA,0xAA,
 121                  0x28,0x08,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 122                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 123                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x03,0x0C,0x30,0x0C,0x03,0x7F,
 124                  0x00,0x00,0x26,0x49,0x49,0x49,0x32,0x00,0x00,0x7F,0x02,0x04,0x08,0x10,0x7F,0x00,
 125          };
 126          /**********************************************
 127          //IIC Start
 128          **********************************************/
 129          void IIC_Start()
 130          {
 131   1         SCL = high;          
 132   1         SDA = high;
 133   1         SDA = low;
 134   1         SCL = low;
 135   1      }
 136          
 137          /**********************************************
 138          //IIC Stop
 139          **********************************************/
 140          void IIC_Stop()
 141          {
 142   1         SCL = low;
 143   1         SDA = low;
 144   1         SCL = high;
 145   1         SDA = high;
 146   1      }
 147          /**********************************************
 148          // IIC Write byte
 149          **********************************************/
 150          void Write_IIC_Byte(unsigned char IIC_Byte)
 151          {
 152   1              unsigned char i;
 153   1              for(i=0;i<8;i++)                
 154   1              {
 155   2                      if(IIC_Byte & 0x80)
 156   2                      SDA=high;
 157   2                      else
 158   2                      SDA=low;
 159   2                      SCL=high;
 160   2                      SCL=low;
 161   2                      IIC_Byte<<=1;
 162   2              }
 163   1              SDA=1;
 164   1              SCL=1;
 165   1              SCL=0;
 166   1      }
 167          /**********************************************
 168          // IIC Write Command
 169          **********************************************/
 170          void Write_IIC_Command(unsigned char IIC_Command)
 171          {
 172   1         IIC_Start();
 173   1         Write_IIC_Byte(0x78);            //Slave address,SA0=0
 174   1         Write_IIC_Byte(0x00);                        //write command
 175   1         Write_IIC_Byte(IIC_Command); 
 176   1         IIC_Stop();
 177   1      }
 178          /**********************************************
C51 COMPILER V8.02   IIC                                                                   12/17/2013 20:24:56 PAGE 4   

 179          // IIC Write Data
 180          **********************************************/
 181          void Write_IIC_Data(unsigned char IIC_Data)
 182          {
 183   1         IIC_Start();
 184   1         Write_IIC_Byte(0x78);                        
 185   1         Write_IIC_Byte(0x40);                        //write data
 186   1         Write_IIC_Byte(IIC_Data);
 187   1         IIC_Stop();
 188   1      }
 189          /********************************************
 190          // fill_Picture
 191          ********************************************/
 192          void fill_picture(unsigned char fill_Data)
 193          {
 194   1              unsigned char m,n;
 195   1              for(m=0;m<8;m++)
 196   1              {
 197   2                      Write_IIC_Command(0xb0+m);              //page0-page1
 198   2                      Write_IIC_Command(0x00);                //low column start address
 199   2                      Write_IIC_Command(0x10);                //high column start address
 200   2                      for(n=0;n<128;n++)
 201   2                              {
 202   3                                      Write_IIC_Data(fill_Data);
 203   3                              }
 204   2              }
 205   1      }
 206          /******************************************
 207          // picture
 208          ******************************************/
 209          void picture_1()
 210          {
 211   1        unsigned char x,y;
 212   1        unsigned int i=0;
 213   1        for(y=0;y<8;y++)
 214   1          {
 215   2            Write_IIC_Command(0xb0+y);
 216   2            Write_IIC_Command(0x00);
 217   2            Write_IIC_Command(0x10);
 218   2            for(x=0;x<128;x++)
 219   2              {
 220   3                Write_IIC_Data(show1[i++]);
 221   3              }
 222   2          }
 223   1      }
 224          
 225          /***********************Delay****************************************/
 226          void Delay_50ms(unsigned int Del_50ms)
 227          {
 228   1              unsigned int m;
 229   1              for(;Del_50ms>0;Del_50ms--)
 230   1                      for(m=6245;m>0;m--);
 231   1      }
 232          
 233          void Delay_1ms(unsigned int Del_1ms)
 234          {
 235   1              unsigned char j;
 236   1              while(Del_1ms--)
 237   1              {       
 238   2                      for(j=0;j<123;j++);
 239   2              }
 240   1      }
C51 COMPILER V8.02   IIC                                                                   12/17/2013 20:24:56 PAGE 5   

 241          /*******************************Main*******************************/
 242          void main(void)
 243          {
 244   1              Initial_LY096BG30();
 245   1              Delay_1ms(5);
 246   1              while(1)
 247   1              {
 248   2                      fill_picture(0xff);//全屏显示
 249   2                      Delay_50ms(25);
 250   2                      fill_picture(0xf0);//全屏灭
 251   2                      Delay_50ms(25);
 252   2                      Picture_1();//显示一张图片
 253   2                      Delay_50ms(25);
 254   2              }
 255   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    399    ----
   CONSTANT SIZE    =   1024    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
